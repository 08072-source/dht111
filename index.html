<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f172a;
  color:white;
}

/* ===== Header ===== */
.header{
  text-align:center;
  padding:15px;
  font-size:24px;
  font-weight:bold;
}

.clock{
  text-align:center;
  color:#38bdf8;
  margin-bottom:15px;
}

/* ===== Card ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ ===== */
.container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:15px;
  padding:10px;
}

.card{
  background:#1e293b;
  border-radius:15px;
  padding:20px;
  width:200px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,0,0,0.4);
}

.value{
  font-size:36px;
  font-weight:bold;
  margin-top:10px;
}

/* ===== ‡∏Å‡∏£‡∏≤‡∏ü ===== */
.chart-box{
  width:95%;
  height:55vh;
  margin:auto;
}

canvas{
  width:100% !important;
  height:100% !important;
}

</style>
</head>

<body>

<div class="header">ESP32 Sensor Dashboard</div>
<div class="clock" id="clock"></div>

<div class="container">

  <div class="card">
    üå° Temperature
    <div class="value" id="tempNow">--</div>
  </div>

  <div class="card">
    üíß Humidity
    <div class="value" id="humNow">--</div>
  </div>

</div>

<div class="chart-box">
  <canvas id="chart"></canvas>
</div>

<script>

const csvUrl = "https://docs.google.com/spreadsheets/d/1is4HVAGQwXNXCZynw3pWGqbM8o_pfZOqkvZQCEfBc_I/export?format=csv&gid=0";

let chart;

/* ===== ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ ===== */
function updateClock(){
  let now = new Date();
  document.getElementById("clock").innerText =
    now.toLocaleString("th-TH");
}
setInterval(updateClock,1000);
updateClock();

/* ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ===== */
async function loadData(){

  const res = await fetch(csvUrl);
  const text = await res.text();

  const rows = text.split("\n").slice(1);

  let time = [];
  let temp = [];
  let hum = [];

  rows.forEach(r=>{
    let col = r.split(",");

    if(col[0] && col[1] && col[2]){

      let t = new Date(col[0]);
      let label = t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

      time.push(label);
      temp.push(parseFloat(col[1]));
      hum.push(parseFloat(col[2]));
    }
  });

  document.getElementById("tempNow").innerText = temp[temp.length-1] + " ¬∞C";
  document.getElementById("humNow").innerText = hum[hum.length-1] + " %";

  drawChart(time,temp,hum);
}

function drawChart(time,temp,hum){

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels:time,
      datasets:[
        {
          label:"Temperature",
          data:temp,
          borderWidth:3,
          tension:0.4
        },
        {
          label:"Humidity",
          data:hum,
          borderWidth:3,
          tension:0.4
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{
        legend:{ labels:{ color:"white" } }
      },
      scales:{
        x:{ ticks:{ color:"white" } },
        y:{ ticks:{ color:"white" } }
      }
    }
  });
}

loadData();
setInterval(loadData,60000);

</script>

</body>
</html>
